version: '3'

run: once

tasks:
  default:
    cmds:
      - cmd: task --list
        ignore_error: true
        silent: true

  profiles:push:
    desc: Pushes profiles to the default profiles directory
    aliases:
      - push
    cmds:
      - python3 .scripts/sync_profiles.py push

  profiles:pull:
    desc: Pulls profiles from the default profiles directory
    aliases:
      - pull
    cmds:
      - python3 .scripts/sync_profiles.py pull
      - task: profiles:clean

  profiles:clean:
    desc: Cleans up profile config files (comments, blanks, etc.)
    aliases:
      - clean
    sources:
      # only run if a profile has changed
      - profiles/**/*
    cmds:
      - python3 .scripts/clean_conf_files.py

  profiles:build:
    desc: Generates an importable profile bundle (after cleaning)
    aliases:
      - build
    deps:
      - clean
    sources:
      # only run if a profile has changed
      - profiles/**/*
    generates:
      # or if no output files already exist
      - .output/wireshark-profiles_bcbrookman_*.*.*.zip
    cmds:
      - python3 .scripts/build_profiles.py

